{"ast":null,"code":"import _asyncToGenerator from\"@babel/runtime/helpers/asyncToGenerator\";import{SyntheticPlatformEmitter,CodedError}from'expo-modules-core';import{VoiceQuality}from\"./Speech.types\";var MAX_SPEECH_INPUT_LENGTH=32767;function _getVoices2(){return _getVoices.apply(this,arguments);}function _getVoices(){_getVoices=_asyncToGenerator(function*(){return new Promise(function(resolve){var voices=window.speechSynthesis.getVoices();if(voices.length>0){resolve(voices);return;}window.speechSynthesis.onvoiceschanged=function(){var voices=window.speechSynthesis.getVoices();resolve(voices);};});});return _getVoices.apply(this,arguments);}export default{get name(){return'ExponentSpeech';},speak:function(){var _speak=_asyncToGenerator(function*(id,text,options){if(text.length>MAX_SPEECH_INPUT_LENGTH){throw new CodedError('ERR_SPEECH_INPUT_LENGTH','Speech input text is too long! Limit of input length is: '+MAX_SPEECH_INPUT_LENGTH);}var message=new SpeechSynthesisUtterance();if(typeof options.rate==='number'){message.rate=options.rate;}if(typeof options.pitch==='number'){message.pitch=options.pitch;}if(typeof options.language==='string'){message.lang=options.language;}if(typeof options.volume==='number'){message.volume=options.volume;}if('_voiceIndex'in options&&options._voiceIndex!=null){var voices=yield _getVoices2();message.voice=voices[Math.min(voices.length-1,Math.max(0,options._voiceIndex))];}if(typeof options.voice==='string'){var _voices=yield _getVoices2();message.voice=_voices[Math.max(0,_voices.findIndex(function(voice){return voice.voiceURI===options.voice;}))];}if(typeof options.onResume==='function'){message.onresume=options.onResume;}if(typeof options.onMark==='function'){message.onmark=options.onMark;}if(typeof options.onBoundary==='function'){message.onboundary=options.onBoundary;}message.onstart=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingStarted',{id:id,nativeEvent:nativeEvent});};message.onend=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingDone',{id:id,nativeEvent:nativeEvent});};message.onpause=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingStopped',{id:id,nativeEvent:nativeEvent});};message.onerror=function(nativeEvent){SyntheticPlatformEmitter.emit('Exponent.speakingError',{id:id,nativeEvent:nativeEvent});};message.text=text;window.speechSynthesis.speak(message);return message;});function speak(_x,_x2,_x3){return _speak.apply(this,arguments);}return speak;}(),getVoices:function(){var _getVoices3=_asyncToGenerator(function*(){var voices=yield _getVoices2();return voices.map(function(voice){return{identifier:voice.voiceURI,quality:VoiceQuality.Default,isDefault:voice.default,language:voice.lang,localService:voice.localService,name:voice.name,voiceURI:voice.voiceURI};});});function getVoices(){return _getVoices3.apply(this,arguments);}return getVoices;}(),isSpeaking:function(){var _isSpeaking=_asyncToGenerator(function*(){return window.speechSynthesis.speaking;});function isSpeaking(){return _isSpeaking.apply(this,arguments);}return isSpeaking;}(),stop:function(){var _stop=_asyncToGenerator(function*(){return window.speechSynthesis.cancel();});function stop(){return _stop.apply(this,arguments);}return stop;}(),pause:function(){var _pause=_asyncToGenerator(function*(){return window.speechSynthesis.pause();});function pause(){return _pause.apply(this,arguments);}return pause;}(),resume:function(){var _resume=_asyncToGenerator(function*(){return window.speechSynthesis.resume();});function resume(){return _resume.apply(this,arguments);}return resume;}(),maxSpeechInputLength:MAX_SPEECH_INPUT_LENGTH};","map":{"version":3,"sources":["../src/Speech/ExponentSpeech.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { SyntheticPlatformEmitter, CodedError } from 'expo-modules-core';\n\nimport { SpeechOptions, WebVoice, VoiceQuality } from './Speech.types';\n\n//https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance/text\nconst MAX_SPEECH_INPUT_LENGTH = 32767;\n\nasync function getVoices(): Promise<SpeechSynthesisVoice[]> {\n  return new Promise<SpeechSynthesisVoice[]>((resolve) => {\n    const voices = window.speechSynthesis.getVoices();\n\n    if (voices.length > 0) {\n      resolve(voices);\n      return;\n    }\n\n    // when a page loads it takes some amount of time to populate the voices list\n    // see https://stackoverflow.com/a/52005323/4337317\n    window.speechSynthesis.onvoiceschanged = function () {\n      const voices = window.speechSynthesis.getVoices();\n      resolve(voices);\n    };\n  });\n}\n\nexport default {\n  get name(): string {\n    return 'ExponentSpeech';\n  },\n  async speak(id: string, text: string, options: SpeechOptions): Promise<SpeechSynthesisUtterance> {\n    if (text.length > MAX_SPEECH_INPUT_LENGTH) {\n      throw new CodedError(\n        'ERR_SPEECH_INPUT_LENGTH',\n        'Speech input text is too long! Limit of input length is: ' + MAX_SPEECH_INPUT_LENGTH\n      );\n    }\n\n    const message = new SpeechSynthesisUtterance();\n\n    if (typeof options.rate === 'number') {\n      message.rate = options.rate;\n    }\n    if (typeof options.pitch === 'number') {\n      message.pitch = options.pitch;\n    }\n    if (typeof options.language === 'string') {\n      message.lang = options.language;\n    }\n    if (typeof options.volume === 'number') {\n      message.volume = options.volume;\n    }\n    if ('_voiceIndex' in options && options._voiceIndex != null) {\n      const voices = await getVoices();\n      message.voice = voices[Math.min(voices.length - 1, Math.max(0, options._voiceIndex))];\n    }\n    if (typeof options.voice === 'string') {\n      const voices = await getVoices();\n      message.voice =\n        voices[\n          Math.max(\n            0,\n            voices.findIndex((voice) => voice.voiceURI === options.voice)\n          )\n        ];\n    }\n    if (typeof options.onResume === 'function') {\n      message.onresume = options.onResume;\n    }\n    if (typeof options.onMark === 'function') {\n      message.onmark = options.onMark;\n    }\n    if (typeof options.onBoundary === 'function') {\n      message.onboundary = options.onBoundary;\n    }\n\n    message.onstart = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingStarted', { id, nativeEvent });\n    };\n    message.onend = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingDone', { id, nativeEvent });\n    };\n    message.onpause = (nativeEvent: SpeechSynthesisEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingStopped', { id, nativeEvent });\n    };\n    message.onerror = (nativeEvent: SpeechSynthesisErrorEvent) => {\n      SyntheticPlatformEmitter.emit('Exponent.speakingError', { id, nativeEvent });\n    };\n\n    message.text = text;\n\n    window.speechSynthesis.speak(message);\n\n    return message;\n  },\n  async getVoices(): Promise<WebVoice[]> {\n    const voices = await getVoices();\n    return voices.map((voice) => ({\n      identifier: voice.voiceURI,\n      quality: VoiceQuality.Default,\n      isDefault: voice.default,\n      language: voice.lang,\n      localService: voice.localService,\n      name: voice.name,\n      voiceURI: voice.voiceURI,\n    }));\n  },\n  async isSpeaking(): Promise<boolean> {\n    return window.speechSynthesis.speaking;\n  },\n  async stop(): Promise<void> {\n    return window.speechSynthesis.cancel();\n  },\n  async pause(): Promise<void> {\n    return window.speechSynthesis.pause();\n  },\n  async resume(): Promise<void> {\n    return window.speechSynthesis.resume();\n  },\n  maxSpeechInputLength: MAX_SPEECH_INPUT_LENGTH,\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}