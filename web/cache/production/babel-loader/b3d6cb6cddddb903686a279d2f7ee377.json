{"ast":null,"code":"var __extends=this&&this.__extends||function(){var _extendStatics=function extendStatics(d,b){_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b;}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p];};return _extendStatics(d,b);};return function(d,b){if(typeof b!==\"function\"&&b!==null)throw new TypeError(\"Class extends value \"+String(b)+\" is not a constructor or null\");_extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p];}return t;};return __assign.apply(this,arguments);};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator[\"throw\"](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function sent(){if(t[0]&1)throw t[1];return t[1];},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),\"throw\":verb(1),\"return\":verb(2)},typeof Symbol===\"function\"&&(g[Symbol.iterator]=function(){return this;}),g;function verb(n){return function(v){return step([n,v]);};}function step(op){if(f)throw new TypeError(\"Generator is already executing.\");while(_)try{if(f=1,y&&(t=op[0]&2?y[\"return\"]:op[0]?y[\"throw\"]||((t=y[\"return\"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue;}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break;}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break;}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break;}if(t[2])_.ops.pop();_.trys.pop();continue;}op=body.call(thisArg,_);}catch(e){op=[6,e];y=0;}finally{f=t=0;}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true};}};var __rest=this&&this.__rest||function(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols===\"function\")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]];}return t;};import React,{Component}from'react';import Dimensions from\"react-native-web/dist/exports/Dimensions\";import Keyboard from\"react-native-web/dist/exports/Keyboard\";import{DEBUG,isIOS}from\"./Constants\";import{Rect}from\"./Types\";import{getChangedProps,getRectForRef}from\"./Utility\";import BasePopover from\"./BasePopover\";var AdaptivePopover=function(_super){__extends(AdaptivePopover,_super);function AdaptivePopover(props){var _this=_super.call(this,props)||this;_this.state={fromRect:null,shiftedDisplayArea:null,defaultDisplayArea:null,displayAreaOffset:null,showing:false};_this.waitForResizeToFinish=false;_this.skipNextDefaultDisplayArea=false;_this._isMounted=false;_this.keyboardDidHideSubscription=null;_this.keyboardDidShowSubscription=null;_this.handleResizeEventSubscription=null;_this.handleResizeEvent=_this.handleResizeEvent.bind(_this);_this.keyboardDidHide=_this.keyboardDidHide.bind(_this);_this.keyboardDidShow=_this.keyboardDidShow.bind(_this);return _this;}AdaptivePopover.prototype.getUnshiftedDisplayArea=function(){return this.props.displayArea||this.state.defaultDisplayArea||new Rect(0,0,Dimensions.get('window').width,Dimensions.get('window').height);};AdaptivePopover.prototype.getDisplayArea=function(){var _a,_b,_c,_d,_e,_f;var displayAreaInsets=this.props.displayAreaInsets;var displayArea=this.state.shiftedDisplayArea||this.getUnshiftedDisplayArea();if(displayAreaInsets){this.debug('[AdaptivePopover] getDisplayArea - displayAreaInsets',displayAreaInsets);return new Rect(displayArea.x+((_a=displayAreaInsets.left)!==null&&_a!==void 0?_a:0),displayArea.y+((_b=displayAreaInsets.top)!==null&&_b!==void 0?_b:0),displayArea.width-((_c=displayAreaInsets.left)!==null&&_c!==void 0?_c:0)-((_d=displayAreaInsets.right)!==null&&_d!==void 0?_d:0),displayArea.height-((_e=displayAreaInsets.top)!==null&&_e!==void 0?_e:0)-((_f=displayAreaInsets.bottom)!==null&&_f!==void 0?_f:0));}return displayArea;};AdaptivePopover.prototype.componentDidMount=function(){this.handleResizeEventSubscription=Dimensions.addEventListener('change',this.handleResizeEvent);if(this.props.fromRect)this.setState({fromRect:this.props.fromRect});else if(this.props.fromRef)this.calculateRectFromRef();this._isMounted=true;};AdaptivePopover.prototype.componentWillUnmount=function(){var _a,_b,_c,_d;this._isMounted=false;if(typeof((_a=this.handleResizeEventSubscription)===null||_a===void 0?void 0:_a.remove)==='function')(_b=this.handleResizeEventSubscription)===null||_b===void 0?void 0:_b.remove();else Dimensions.removeEventListener('change',this.handleResizeEvent);(_c=this.keyboardDidShowSubscription)===null||_c===void 0?void 0:_c.remove();(_d=this.keyboardDidHideSubscription)===null||_d===void 0?void 0:_d.remove();};AdaptivePopover.prototype.componentDidUpdate=function(prevProps){var importantProps=['fromRef','fromRect','displayArea'];var changedProps=getChangedProps(this.props,prevProps,importantProps);if(!changedProps.length)return;this.debug('[AdaptivePopover] componentDidUpdate - changedProps',changedProps);if(changedProps.includes('fromRect')){this.debug('componentDidUpdate - fromRect changed',this.props.fromRect);this.setState({fromRect:this.props.fromRect||null});}else if(this.props.fromRef!==prevProps.fromRef){this.debug('componentDidUpdate - fromRef changed');if(this.props.fromRef)this.calculateRectFromRef();else this.setState({fromRect:null});}if(this.props.isVisible&&prevProps.isVisible){if(changedProps.includes('displayArea')||this.displayAreaStore&&!this.getDisplayArea().equals(this.displayAreaStore)){this.debug('componentDidUpdate - displayArea changed',this.getDisplayArea());this.displayAreaStore=this.getDisplayArea();}}};AdaptivePopover.prototype.handleResizeEvent=function(change){this.debug('handleResizeEvent - New Dimensions',change);if(this.props.isVisible){this.waitForResizeToFinish=true;}};AdaptivePopover.prototype.debug=function(line,obj){if(DEBUG||this.props.debug)console.log(\"[\"+new Date().toISOString()+\"] \"+line+(obj?\": \"+JSON.stringify(obj):''));};AdaptivePopover.prototype.setDefaultDisplayArea=function(newDisplayArea){return __awaiter(this,void 0,void 0,function(){var defaultDisplayArea,isValidDisplayArea,displayAreaOffset_1;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(!this._isMounted)return[2];defaultDisplayArea=this.state.defaultDisplayArea;isValidDisplayArea=newDisplayArea.width>0&&newDisplayArea.height>0;if(!((!defaultDisplayArea||!newDisplayArea.equals(defaultDisplayArea))&&isValidDisplayArea))return[3,6];this.debug('setDefaultDisplayArea - newDisplayArea',newDisplayArea);if(!!this.skipNextDefaultDisplayArea)return[3,5];return[4,this.props.getDisplayAreaOffset()];case 1:displayAreaOffset_1=_a.sent();this.debug('setDefaultDisplayArea - displayAreaOffset',displayAreaOffset_1);return[4,new Promise(function(resolve){_this.setState({defaultDisplayArea:newDisplayArea,displayAreaOffset:displayAreaOffset_1},function(){return resolve(null);});})];case 2:_a.sent();if(!this.props.fromRef)return[3,4];return[4,this.calculateRectFromRef()];case 3:_a.sent();_a.label=4;case 4:this.waitForResizeToFinish=false;this.displayAreaStore=this.getDisplayArea();_a.label=5;case 5:if(this.skipNextDefaultDisplayArea)this.debug('setDefaultDisplayArea - Skipping first because isLandscape');this.skipNextDefaultDisplayArea=false;_a.label=6;case 6:return[2];}});});};AdaptivePopover.prototype.keyboardDidShow=function(e){this.debug(\"keyboardDidShow - keyboard height: \"+e.endCoordinates.height);this.shiftForKeyboard(e.endCoordinates.height);};AdaptivePopover.prototype.keyboardDidHide=function(){this.debug('keyboardDidHide');if(this._isMounted)this.setState({shiftedDisplayArea:null});};AdaptivePopover.prototype.shiftForKeyboard=function(keyboardHeight){var displayArea=this.getUnshiftedDisplayArea();var absoluteVerticalCutoff=Dimensions.get('window').height-keyboardHeight-(isIOS?10:40);var combinedY=Math.min(displayArea.height+displayArea.y,absoluteVerticalCutoff);this.setState({shiftedDisplayArea:new Rect(displayArea.x,displayArea.y,displayArea.width,combinedY-displayArea.y)});};AdaptivePopover.prototype.calculateRectFromRef=function(){var _a,_b;return __awaiter(this,void 0,void 0,function(){var fromRef,initialRect,displayAreaOffset,count,verticalOffset,horizontalOffset,rect;return __generator(this,function(_c){switch(_c.label){case 0:fromRef=this.props.fromRef;initialRect=this.state.fromRect||new Rect(0,0,0,0);displayAreaOffset=(_a=this.state.displayAreaOffset)!==null&&_a!==void 0?_a:{x:0,y:0};this.debug('calculateRectFromRef - waiting for ref');count=0;_c.label=1;case 1:if(!!(fromRef===null||fromRef===void 0?void 0:fromRef.current))return[3,3];return[4,new Promise(function(resolve){setTimeout(resolve,100);})];case 2:_c.sent();if(count++>20)return[2];return[3,1];case 3:verticalOffset=((_b=this.props.verticalOffset)!==null&&_b!==void 0?_b:0)-displayAreaOffset.y;horizontalOffset=-displayAreaOffset.x;this.debug('calculateRectFromRef - waiting for ref to move from',initialRect);count=0;_c.label=4;case 4:return[4,getRectForRef(fromRef)];case 5:rect=_c.sent();if([rect.x,rect.y,rect.width,rect.height].every(function(i){return i===undefined;})){this.debug('calculateRectFromRef - rect not found, all properties undefined');return[2];}rect=new Rect(rect.x+horizontalOffset,rect.y+verticalOffset,rect.width,rect.height);return[4,new Promise(function(resolve){setTimeout(resolve,100);})];case 6:_c.sent();if(count++>20)return[2];_c.label=7;case 7:if(rect.equals(initialRect)||rect.y<-1000||rect.x<-1000)return[3,4];_c.label=8;case 8:this.debug('calculateRectFromRef - calculated Rect',rect);if(this._isMounted)this.setState({fromRect:rect});return[2];}});});};AdaptivePopover.prototype.render=function(){var _this=this;var _a=this.props,_onOpenStart=_a.onOpenStart,_onCloseStart=_a.onCloseStart,_onCloseComplete=_a.onCloseComplete,fromRef=_a.fromRef,otherProps=__rest(_a,[\"onOpenStart\",\"onCloseStart\",\"onCloseComplete\",\"fromRef\"]);var _b=this.state,fromRect=_b.fromRect,showing=_b.showing;if(fromRef&&!fromRect&&!showing)return null;return React.createElement(BasePopover,__assign({},otherProps,{displayArea:this.getDisplayArea(),fromRect:fromRect,onOpenStart:function onOpenStart(){_onOpenStart===null||_onOpenStart===void 0?void 0:_onOpenStart();_this.debug('Setting up keyboard listeners');_this.keyboardDidShowSubscription=Keyboard.addListener('keyboardDidShow',_this.keyboardDidShow);_this.keyboardDidHideSubscription=Keyboard.addListener('keyboardDidHide',_this.keyboardDidHide);_this.displayAreaStore=_this.getDisplayArea();_this.setState({showing:true});},onCloseStart:function onCloseStart(){_onCloseStart===null||_onCloseStart===void 0?void 0:_onCloseStart();_this.debug('Tearing down keyboard listeners');if(_this.keyboardDidShowSubscription!==null){_this.keyboardDidShowSubscription.remove();_this.keyboardDidShowSubscription=null;}if(_this.keyboardDidHideSubscription!==null){_this.keyboardDidHideSubscription.remove();_this.keyboardDidHideSubscription=null;}if(_this._isMounted)_this.setState({shiftedDisplayArea:null});},onCloseComplete:function onCloseComplete(){_this.setState({showing:false},function(){_onCloseComplete===null||_onCloseComplete===void 0?void 0:_onCloseComplete();});},skipMeasureContent:function skipMeasureContent(){return _this.waitForResizeToFinish;},onDisplayAreaChanged:function onDisplayAreaChanged(rect){return _this.setDefaultDisplayArea(rect);}}));};return AdaptivePopover;}(Component);export default AdaptivePopover;","map":{"version":3,"sources":["../src/AdaptivePopover.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React, { Component } from 'react';\nimport { Dimensions, Keyboard } from 'react-native';\nimport { DEBUG, isIOS } from './Constants';\nimport { Rect } from './Types';\nimport { getChangedProps, getRectForRef } from './Utility';\nimport BasePopover from './BasePopover';\nvar AdaptivePopover = /** @class */ (function (_super) {\n    __extends(AdaptivePopover, _super);\n    function AdaptivePopover(props) {\n        var _this = _super.call(this, props) || this;\n        _this.state = {\n            fromRect: null,\n            shiftedDisplayArea: null,\n            defaultDisplayArea: null,\n            displayAreaOffset: null,\n            showing: false\n        };\n        /*\n         * This is used so that when the device is rotating\n         * or the viewport is expanding for any other reason,\n         * we can suspend updates due to content changes until\n         * we are finished calculating the new display\n         * area and rect for the new viewport size.\n         * This makes the recalc on rotation much faster.\n         */\n        _this.waitForResizeToFinish = false;\n        _this.skipNextDefaultDisplayArea = false;\n        _this._isMounted = false;\n        _this.keyboardDidHideSubscription = null;\n        _this.keyboardDidShowSubscription = null;\n        _this.handleResizeEventSubscription = null;\n        _this.handleResizeEvent = _this.handleResizeEvent.bind(_this);\n        _this.keyboardDidHide = _this.keyboardDidHide.bind(_this);\n        _this.keyboardDidShow = _this.keyboardDidShow.bind(_this);\n        return _this;\n    }\n    AdaptivePopover.prototype.getUnshiftedDisplayArea = function () {\n        return this.props.displayArea ||\n            this.state.defaultDisplayArea ||\n            new Rect(0, 0, Dimensions.get('window').width, Dimensions.get('window').height);\n    };\n    // Apply insets and shifts if needed\n    AdaptivePopover.prototype.getDisplayArea = function () {\n        var _a, _b, _c, _d, _e, _f;\n        var displayAreaInsets = this.props.displayAreaInsets;\n        var displayArea = this.state.shiftedDisplayArea || this.getUnshiftedDisplayArea();\n        if (displayAreaInsets) {\n            this.debug('[AdaptivePopover] getDisplayArea - displayAreaInsets', displayAreaInsets);\n            return new Rect(displayArea.x + ((_a = displayAreaInsets.left) !== null && _a !== void 0 ? _a : 0), displayArea.y + ((_b = displayAreaInsets.top) !== null && _b !== void 0 ? _b : 0), displayArea.width - ((_c = displayAreaInsets.left) !== null && _c !== void 0 ? _c : 0) - ((_d = displayAreaInsets.right) !== null && _d !== void 0 ? _d : 0), displayArea.height - ((_e = displayAreaInsets.top) !== null && _e !== void 0 ? _e : 0) - ((_f = displayAreaInsets.bottom) !== null && _f !== void 0 ? _f : 0));\n        }\n        return displayArea;\n    };\n    AdaptivePopover.prototype.componentDidMount = function () {\n        this.handleResizeEventSubscription = Dimensions.addEventListener('change', this.handleResizeEvent);\n        if (this.props.fromRect)\n            this.setState({ fromRect: this.props.fromRect });\n        else if (this.props.fromRef)\n            this.calculateRectFromRef();\n        this._isMounted = true;\n    };\n    AdaptivePopover.prototype.componentWillUnmount = function () {\n        var _a, _b, _c, _d;\n        this._isMounted = false;\n        if (typeof ((_a = this.handleResizeEventSubscription) === null || _a === void 0 ? void 0 : _a.remove) === 'function')\n            (_b = this.handleResizeEventSubscription) === null || _b === void 0 ? void 0 : _b.remove();\n        else\n            // Backward-compatibility with RN <= 0.63\n            Dimensions.removeEventListener('change', this.handleResizeEvent);\n        (_c = this.keyboardDidShowSubscription) === null || _c === void 0 ? void 0 : _c.remove();\n        (_d = this.keyboardDidHideSubscription) === null || _d === void 0 ? void 0 : _d.remove();\n    };\n    AdaptivePopover.prototype.componentDidUpdate = function (prevProps) {\n        // Make sure a value we care about has actually changed\n        var importantProps = ['fromRef', 'fromRect', 'displayArea'];\n        var changedProps = getChangedProps(this.props, prevProps, importantProps);\n        if (!changedProps.length)\n            return;\n        this.debug('[AdaptivePopover] componentDidUpdate - changedProps', changedProps);\n        if (changedProps.includes('fromRect')) {\n            this.debug('componentDidUpdate - fromRect changed', this.props.fromRect);\n            this.setState({ fromRect: this.props.fromRect || null });\n        }\n        else if (this.props.fromRef !== prevProps.fromRef) {\n            this.debug('componentDidUpdate - fromRef changed');\n            if (this.props.fromRef)\n                this.calculateRectFromRef();\n            else\n                this.setState({ fromRect: null });\n        }\n        if (this.props.isVisible && prevProps.isVisible) {\n            if (changedProps.includes('displayArea') ||\n                (this.displayAreaStore &&\n                    !this.getDisplayArea().equals(this.displayAreaStore))) {\n                this.debug('componentDidUpdate - displayArea changed', this.getDisplayArea());\n                this.displayAreaStore = this.getDisplayArea();\n            }\n        }\n    };\n    // First thing called when device rotates\n    AdaptivePopover.prototype.handleResizeEvent = function (change) {\n        this.debug('handleResizeEvent - New Dimensions', change);\n        if (this.props.isVisible) {\n            this.waitForResizeToFinish = true;\n        }\n    };\n    AdaptivePopover.prototype.debug = function (line, obj) {\n        if (DEBUG || this.props.debug)\n            console.log(\"[\" + (new Date()).toISOString() + \"] \" + line + (obj ? \": \" + JSON.stringify(obj) : ''));\n    };\n    AdaptivePopover.prototype.setDefaultDisplayArea = function (newDisplayArea) {\n        return __awaiter(this, void 0, void 0, function () {\n            var defaultDisplayArea, isValidDisplayArea, displayAreaOffset_1;\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this._isMounted)\n                            return [2 /*return*/];\n                        defaultDisplayArea = this.state.defaultDisplayArea;\n                        isValidDisplayArea = newDisplayArea.width > 0 && newDisplayArea.height > 0;\n                        if (!((!defaultDisplayArea || !newDisplayArea.equals(defaultDisplayArea)) &&\n                            isValidDisplayArea)) return [3 /*break*/, 6];\n                        this.debug('setDefaultDisplayArea - newDisplayArea', newDisplayArea);\n                        if (!!this.skipNextDefaultDisplayArea) return [3 /*break*/, 5];\n                        return [4 /*yield*/, this.props.getDisplayAreaOffset()];\n                    case 1:\n                        displayAreaOffset_1 = _a.sent();\n                        this.debug('setDefaultDisplayArea - displayAreaOffset', displayAreaOffset_1);\n                        return [4 /*yield*/, new Promise(function (resolve) {\n                                _this.setState({ defaultDisplayArea: newDisplayArea, displayAreaOffset: displayAreaOffset_1 }, function () { return resolve(null); });\n                            })];\n                    case 2:\n                        _a.sent();\n                        if (!this.props.fromRef) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.calculateRectFromRef()];\n                    case 3:\n                        _a.sent();\n                        _a.label = 4;\n                    case 4:\n                        this.waitForResizeToFinish = false;\n                        this.displayAreaStore = this.getDisplayArea();\n                        _a.label = 5;\n                    case 5:\n                        if (this.skipNextDefaultDisplayArea)\n                            this.debug('setDefaultDisplayArea - Skipping first because isLandscape');\n                        this.skipNextDefaultDisplayArea = false;\n                        _a.label = 6;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    // Custom type here, as KeyboardEvent type does not contain endCoordinates\n    AdaptivePopover.prototype.keyboardDidShow = function (e) {\n        this.debug(\"keyboardDidShow - keyboard height: \" + e.endCoordinates.height);\n        this.shiftForKeyboard(e.endCoordinates.height);\n    };\n    AdaptivePopover.prototype.keyboardDidHide = function () {\n        this.debug('keyboardDidHide');\n        if (this._isMounted)\n            this.setState({ shiftedDisplayArea: null });\n    };\n    AdaptivePopover.prototype.shiftForKeyboard = function (keyboardHeight) {\n        var displayArea = this.getUnshiftedDisplayArea();\n        var absoluteVerticalCutoff = Dimensions.get('window').height - keyboardHeight - (isIOS ? 10 : 40);\n        var combinedY = Math.min(displayArea.height + displayArea.y, absoluteVerticalCutoff);\n        this.setState({\n            shiftedDisplayArea: new Rect(displayArea.x, displayArea.y, displayArea.width, combinedY - displayArea.y)\n        });\n    };\n    AdaptivePopover.prototype.calculateRectFromRef = function () {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function () {\n            var fromRef, initialRect, displayAreaOffset, count, verticalOffset, horizontalOffset, rect;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        fromRef = this.props.fromRef;\n                        initialRect = this.state.fromRect || new Rect(0, 0, 0, 0);\n                        displayAreaOffset = (_a = this.state.displayAreaOffset) !== null && _a !== void 0 ? _a : { x: 0, y: 0 };\n                        this.debug('calculateRectFromRef - waiting for ref');\n                        count = 0;\n                        _c.label = 1;\n                    case 1:\n                        if (!!(fromRef === null || fromRef === void 0 ? void 0 : fromRef.current)) return [3 /*break*/, 3];\n                        return [4 /*yield*/, new Promise(function (resolve) {\n                                setTimeout(resolve, 100);\n                            })];\n                    case 2:\n                        _c.sent();\n                        // Timeout after 2 seconds\n                        if (count++ > 20)\n                            return [2 /*return*/];\n                        return [3 /*break*/, 1];\n                    case 3:\n                        verticalOffset = ((_b = this.props.verticalOffset) !== null && _b !== void 0 ? _b : 0) - displayAreaOffset.y;\n                        horizontalOffset = -displayAreaOffset.x;\n                        this.debug('calculateRectFromRef - waiting for ref to move from', initialRect);\n                        count = 0;\n                        _c.label = 4;\n                    case 4: return [4 /*yield*/, getRectForRef(fromRef)];\n                    case 5:\n                        rect = _c.sent();\n                        if ([rect.x, rect.y, rect.width, rect.height].every(function (i) { return i === undefined; })) {\n                            this.debug('calculateRectFromRef - rect not found, all properties undefined');\n                            return [2 /*return*/];\n                        }\n                        rect = new Rect(rect.x + horizontalOffset, rect.y + verticalOffset, rect.width, rect.height);\n                        return [4 /*yield*/, new Promise(function (resolve) {\n                                setTimeout(resolve, 100);\n                            })];\n                    case 6:\n                        _c.sent();\n                        // Timeout after 2 seconds\n                        if (count++ > 20)\n                            return [2 /*return*/];\n                        _c.label = 7;\n                    case 7:\n                        if (rect.equals(initialRect) || rect.y < -1000 || rect.x < -1000) return [3 /*break*/, 4];\n                        _c.label = 8;\n                    case 8:\n                        this.debug('calculateRectFromRef - calculated Rect', rect);\n                        if (this._isMounted)\n                            this.setState({ fromRect: rect });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    AdaptivePopover.prototype.render = function () {\n        var _this = this;\n        var _a = this.props, onOpenStart = _a.onOpenStart, onCloseStart = _a.onCloseStart, onCloseComplete = _a.onCloseComplete, fromRef = _a.fromRef, otherProps = __rest(_a, [\"onOpenStart\", \"onCloseStart\", \"onCloseComplete\", \"fromRef\"]);\n        var _b = this.state, fromRect = _b.fromRect, showing = _b.showing;\n        // Don't render popover until we have an initial fromRect calculated for the view\n        if (fromRef && !fromRect && !showing)\n            return null;\n        return (React.createElement(BasePopover, __assign({}, otherProps, { displayArea: this.getDisplayArea(), fromRect: fromRect, onOpenStart: function () {\n                onOpenStart === null || onOpenStart === void 0 ? void 0 : onOpenStart();\n                _this.debug('Setting up keyboard listeners');\n                _this.keyboardDidShowSubscription = Keyboard.addListener('keyboardDidShow', _this.keyboardDidShow);\n                _this.keyboardDidHideSubscription = Keyboard.addListener('keyboardDidHide', _this.keyboardDidHide);\n                _this.displayAreaStore = _this.getDisplayArea();\n                _this.setState({ showing: true });\n            }, onCloseStart: function () {\n                onCloseStart === null || onCloseStart === void 0 ? void 0 : onCloseStart();\n                _this.debug('Tearing down keyboard listeners');\n                if (_this.keyboardDidShowSubscription !== null) {\n                    _this.keyboardDidShowSubscription.remove();\n                    _this.keyboardDidShowSubscription = null;\n                }\n                if (_this.keyboardDidHideSubscription !== null) {\n                    _this.keyboardDidHideSubscription.remove();\n                    _this.keyboardDidHideSubscription = null;\n                }\n                if (_this._isMounted)\n                    _this.setState({ shiftedDisplayArea: null });\n            }, onCloseComplete: function () {\n                _this.setState({ showing: false }, function () {\n                    onCloseComplete === null || onCloseComplete === void 0 ? void 0 : onCloseComplete();\n                });\n            }, skipMeasureContent: function () { return _this.waitForResizeToFinish; }, onDisplayAreaChanged: function (rect) { return _this.setDefaultDisplayArea(rect); } })));\n    };\n    return AdaptivePopover;\n}(Component));\nexport default AdaptivePopover;\n//# sourceMappingURL=AdaptivePopover.js.map"]},"metadata":{},"sourceType":"module"}