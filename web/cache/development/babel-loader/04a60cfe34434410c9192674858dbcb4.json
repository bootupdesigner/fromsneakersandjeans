{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return _extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    _extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport React, { Component } from 'react';\nimport Animated from \"react-native-web/dist/exports/Animated\";\nimport Easing from \"react-native-web/dist/exports/Easing\";\nimport I18nManager from \"react-native-web/dist/exports/I18nManager\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableWithoutFeedback from \"react-native-web/dist/exports/TouchableWithoutFeedback\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Arrow from \"./Arrow\";\nimport { DEBUG, DEFAULT_ARROW_SIZE, FIX_SHIFT, isWeb, styles } from \"./Constants\";\nimport { computeGeometry, Geometry } from \"./Geometry\";\nimport { Placement, Point, Rect, Size } from \"./Types\";\nimport { getChangedProps, getRectForRef } from \"./Utility\";\nvar BasePopover = function (_super) {\n  __extends(BasePopover, _super);\n  function BasePopover() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this.state = {\n      requestedContentSize: null,\n      activeGeom: undefined,\n      nextGeom: undefined,\n      showing: false,\n      animatedValues: {\n        scale: new Animated.Value(0),\n        translate: new Animated.ValueXY(),\n        fade: new Animated.Value(0),\n        translateArrow: new Animated.ValueXY()\n      }\n    };\n    _this._isMounted = false;\n    _this.animating = false;\n    _this.animateOutAfterShow = false;\n    _this.popoverRef = React.createRef();\n    _this.arrowRef = React.createRef();\n    return _this;\n  }\n  BasePopover.prototype.debug = function (line, obj) {\n    if (DEBUG || this.props.debug) console.log(\"[\" + new Date().toISOString() + \"] \" + line + (obj ? \": \" + JSON.stringify(obj) : ''));\n  };\n  BasePopover.prototype.componentDidMount = function () {\n    this._isMounted = true;\n  };\n  BasePopover.prototype.componentDidUpdate = function (prevProps) {\n    var importantProps = ['isVisible', 'fromRect', 'displayArea', 'verticalOffset', 'offset', 'placement'];\n    var changedProps = getChangedProps(this.props, prevProps, importantProps);\n    if (!changedProps.length) return;\n    this.debug('[BasePopover] componentDidUpdate - changedProps', changedProps);\n    if (this.props.isVisible !== prevProps.isVisible) {\n      this.debug(\"componentDidUpdate - isVisible changed, now \" + this.props.isVisible);\n      if (!this.props.isVisible) {\n        if (this.state.showing) this.animateOut();else this.animateOutAfterShow = true;\n        this.debug('componentDidUpdate - Hiding popover');\n      }\n    } else if (this.props.isVisible && prevProps.isVisible) {\n      this.debug('componentDidUpdate - isVisible not changed, handling other changes');\n      this.handleChange();\n    }\n  };\n  BasePopover.prototype.componentWillUnmount = function () {\n    this._isMounted = false;\n    if (this.state.showing) {\n      this.debug('componentWillUnmount');\n      this.animateOut();\n    }\n  };\n  BasePopover.prototype.measureContent = function (requestedContentSize) {\n    var _this = this;\n    if (!requestedContentSize.width) {\n      console.warn(\"Popover Warning - Can't Show - The Popover content has a width of 0, so there is nothing to present.\");\n      return;\n    }\n    if (!requestedContentSize.height) {\n      console.warn(\"Popover Warning - Can't Show - The Popover content has a height of 0, so there is nothing to present.\");\n      return;\n    }\n    if (this.props.skipMeasureContent()) {\n      this.debug(\"measureContent - Skipping, waiting for resize to finish\");\n      return;\n    }\n    if (!this.state.requestedContentSize || !requestedContentSize.equals(this.state.requestedContentSize)) {\n      this.debug(\"measureContent - new requestedContentSize: \" + JSON.stringify(requestedContentSize) + \" (used to be \" + JSON.stringify(this.state.requestedContentSize) + \")\");\n      this.setState({\n        requestedContentSize: requestedContentSize\n      }, function () {\n        return _this.handleChange();\n      });\n    } else {\n      this.debug(\"measureContent - Skipping, content size did not change\");\n    }\n  };\n  BasePopover.prototype.handleChange = function () {\n    var _this = this;\n    if (this.handleChangeTimeout) clearTimeout(this.handleChangeTimeout);\n    if (!this.state.requestedContentSize) {\n      this.debug('handleChange - no requestedContentSize, exiting...');\n      return;\n    }\n    this.debug('handleChange - waiting 100ms to accumulate all changes');\n    this.handleChangeTimeout = setTimeout(function () {\n      var _a = _this.state,\n        activeGeom = _a.activeGeom,\n        animatedValues = _a.animatedValues,\n        requestedContentSize = _a.requestedContentSize;\n      var _b = _this.props,\n        arrowSize = _b.arrowSize,\n        popoverStyle = _b.popoverStyle,\n        fromRect = _b.fromRect,\n        displayArea = _b.displayArea,\n        placement = _b.placement,\n        onOpenStart = _b.onOpenStart,\n        arrowShift = _b.arrowShift,\n        onPositionChange = _b.onPositionChange,\n        offset = _b.offset,\n        popoverShift = _b.popoverShift;\n      if (requestedContentSize) {\n        _this.debug('handleChange - requestedContentSize', requestedContentSize);\n        _this.debug('handleChange - displayArea', displayArea);\n        _this.debug('handleChange - fromRect', fromRect);\n        if (placement) _this.debug('handleChange - placement', placement.toString());\n        var geom_1 = computeGeometry({\n          requestedContentSize: requestedContentSize,\n          placement: placement,\n          fromRect: fromRect,\n          displayArea: displayArea,\n          arrowSize: arrowSize || DEFAULT_ARROW_SIZE,\n          popoverStyle: popoverStyle,\n          arrowShift: arrowShift,\n          debug: _this.debug.bind(_this),\n          previousPlacement: _this.getGeom().placement,\n          offset: offset,\n          popoverShift: popoverShift\n        });\n        _this.setState({\n          nextGeom: geom_1,\n          requestedContentSize: requestedContentSize\n        }, function () {\n          if (geom_1.viewLargerThanDisplayArea.width || geom_1.viewLargerThanDisplayArea.height) {\n            _this.debug('handleChange - delaying showing popover because viewLargerThanDisplayArea');\n          } else if (!activeGeom) {\n            _this.debug('handleChange - animating in');\n            if (onOpenStart) setTimeout(onOpenStart);\n            _this.animateIn();\n          } else if (activeGeom && !Geometry.equals(activeGeom, geom_1)) {\n            var moveTo = new Point(geom_1.popoverOrigin.x, geom_1.popoverOrigin.y);\n            _this.debug('handleChange - Triggering popover move to', moveTo);\n            _this.animateTo({\n              values: animatedValues,\n              fade: 1,\n              scale: 1,\n              translatePoint: moveTo,\n              easing: Easing.inOut(Easing.quad),\n              geom: geom_1,\n              callback: onPositionChange\n            });\n          } else {\n            _this.debug('handleChange - no change');\n          }\n        });\n      }\n    }, 100);\n  };\n  BasePopover.getPolarity = function () {\n    return I18nManager.isRTL ? -1 : 1;\n  };\n  BasePopover.prototype.getGeom = function () {\n    var _a = this.state,\n      activeGeom = _a.activeGeom,\n      nextGeom = _a.nextGeom;\n    if (activeGeom) return activeGeom;\n    if (nextGeom) return nextGeom;\n    return new Geometry({\n      popoverOrigin: new Point(0, 0),\n      anchorPoint: new Point(0, 0),\n      placement: Placement.AUTO,\n      forcedContentSize: new Size(0, 0),\n      viewLargerThanDisplayArea: {\n        width: false,\n        height: false\n      }\n    });\n  };\n  BasePopover.prototype.getTranslateOrigin = function () {\n    var requestedContentSize = this.state.requestedContentSize;\n    var arrowSize = this.props.arrowSize || DEFAULT_ARROW_SIZE;\n    var _a = this.getGeom(),\n      forcedContentSize = _a.forcedContentSize,\n      viewLargerThanDisplayArea = _a.viewLargerThanDisplayArea,\n      anchorPoint = _a.anchorPoint,\n      placement = _a.placement;\n    var viewWidth = 0;\n    if (viewLargerThanDisplayArea.width && (forcedContentSize === null || forcedContentSize === void 0 ? void 0 : forcedContentSize.width)) viewWidth = forcedContentSize.width;else if (requestedContentSize === null || requestedContentSize === void 0 ? void 0 : requestedContentSize.width) viewWidth = requestedContentSize.width;\n    if ([Placement.LEFT, Placement.RIGHT].includes(placement)) viewWidth += arrowSize.height;\n    var viewHeight = 0;\n    if (viewLargerThanDisplayArea.height && (forcedContentSize === null || forcedContentSize === void 0 ? void 0 : forcedContentSize.height)) viewHeight = forcedContentSize.height;else if (requestedContentSize === null || requestedContentSize === void 0 ? void 0 : requestedContentSize.height) viewHeight = requestedContentSize.height;\n    if ([Placement.TOP, Placement.BOTTOM].includes(placement)) viewHeight += arrowSize.height;\n    this.debug('getTranslateOrigin - popoverSize', {\n      width: viewWidth,\n      height: viewHeight\n    });\n    this.debug('getTranslateOrigin - anchorPoint', anchorPoint);\n    return new Point(anchorPoint.x - viewWidth / 2, anchorPoint.y - viewHeight / 2);\n  };\n  BasePopover.prototype.animateOut = function () {\n    var _this = this;\n    if (this.props.onCloseStart) setTimeout(this.props.onCloseStart);\n    if (this._isMounted) this.setState({\n      showing: false\n    });\n    this.debug('animateOut - isMounted', this._isMounted);\n    this.animateTo({\n      values: this.state.animatedValues,\n      fade: 0,\n      scale: 0,\n      translatePoint: this.getTranslateOrigin(),\n      callback: function callback() {\n        return setTimeout(_this.props.onCloseComplete);\n      },\n      easing: Easing.inOut(Easing.quad),\n      geom: this.getGeom()\n    });\n  };\n  BasePopover.prototype.animateIn = function () {\n    var _this = this;\n    var nextGeom = this.state.nextGeom;\n    if (nextGeom !== undefined && nextGeom instanceof Geometry) {\n      var values = this.state.animatedValues;\n      var translateStart = this.getTranslateOrigin();\n      translateStart.y += FIX_SHIFT;\n      values.translate.setValue(translateStart);\n      var translatePoint = new Point(nextGeom.popoverOrigin.x, nextGeom.popoverOrigin.y);\n      this.debug('animateIn - translateStart', translateStart);\n      this.debug('animateIn - translatePoint', translatePoint);\n      this.animateTo({\n        values: values,\n        fade: 1,\n        scale: 1,\n        translatePoint: translatePoint,\n        easing: Easing.out(Easing.back(1)),\n        geom: nextGeom,\n        callback: function callback() {\n          if (_this._isMounted) {\n            _this.setState({\n              showing: true\n            });\n            if (_this.props.debug || DEBUG) {\n              setTimeout(function () {\n                return _this.popoverRef.current && getRectForRef(_this.popoverRef).then(function (rect) {\n                  return _this.debug('animateIn - onOpenComplete - Calculated Popover Rect', rect);\n                });\n              });\n              setTimeout(function () {\n                return _this.arrowRef.current && getRectForRef(_this.arrowRef).then(function (rect) {\n                  return _this.debug('animateIn - onOpenComplete - Calculated Arrow Rect', rect);\n                });\n              });\n            }\n          }\n          if (_this.props.onOpenComplete) setTimeout(_this.props.onOpenComplete);\n          if (_this.animateOutAfterShow || !_this._isMounted) {\n            _this.animateOut();\n            _this.animateOutAfterShow = false;\n          }\n        }\n      });\n    }\n  };\n  BasePopover.prototype.animateTo = function (args) {\n    var _this = this;\n    var fade = args.fade,\n      translatePoint = args.translatePoint,\n      scale = args.scale,\n      callback = args.callback,\n      easing = args.easing,\n      values = args.values;\n    var commonConfig = __assign({\n      duration: 300,\n      easing: easing,\n      useNativeDriver: !isWeb\n    }, this.props.animationConfig);\n    if (this.animating) {\n      setTimeout(function () {\n        return _this.animateTo(args);\n      }, 100);\n      return;\n    }\n    translatePoint.y = translatePoint.y + FIX_SHIFT;\n    if (!fade && fade !== 0) {\n      console.log('Popover: Fade value is null');\n      return;\n    }\n    if (!translatePoint) {\n      console.log('Popover: Translate Point value is null');\n      return;\n    }\n    if (!scale && scale !== 0) {\n      console.log('Popover: Scale value is null');\n      return;\n    }\n    this.animating = true;\n    Animated.parallel([Animated.timing(values.fade, __assign(__assign({}, commonConfig), {\n      toValue: fade\n    })), Animated.timing(values.translate, __assign(__assign({}, commonConfig), {\n      toValue: translatePoint\n    })), Animated.timing(values.scale, __assign(__assign({}, commonConfig), {\n      toValue: scale\n    }))]).start(function () {\n      _this.animating = false;\n      if (_this._isMounted) _this.setState({\n        activeGeom: _this.state.nextGeom\n      });\n      if (callback) callback();\n    });\n  };\n  BasePopover.prototype.render = function () {\n    var _this = this;\n    var _a = this.state,\n      animatedValues = _a.animatedValues,\n      nextGeom = _a.nextGeom,\n      requestedContentSize = _a.requestedContentSize;\n    var flattenedPopoverStyle = StyleSheet.flatten(this.props.popoverStyle);\n    var arrowSize = this.props.arrowSize || DEFAULT_ARROW_SIZE;\n    var geom = this.getGeom();\n    var transformStyle = __assign(__assign({\n      position: 'absolute'\n    }, requestedContentSize), {\n      transform: [{\n        translateX: animatedValues.translate.x\n      }, {\n        translateY: animatedValues.translate.y\n      }, {\n        scale: animatedValues.scale\n      }]\n    });\n    var shadowOffset = flattenedPopoverStyle.shadowOffset,\n      shadowColor = flattenedPopoverStyle.shadowColor,\n      shadowOpacity = flattenedPopoverStyle.shadowOpacity,\n      shadowRadius = flattenedPopoverStyle.shadowRadius,\n      elevation = flattenedPopoverStyle.elevation,\n      otherPopoverStyles = __rest(flattenedPopoverStyle, [\"shadowOffset\", \"shadowColor\", \"shadowOpacity\", \"shadowRadius\", \"elevation\"]);\n    var shadowStyle = {\n      shadowOffset: shadowOffset,\n      shadowColor: shadowColor,\n      shadowOpacity: shadowOpacity,\n      shadowRadius: shadowRadius\n    };\n    var contentWrapperStyle = __assign(__assign(__assign({}, styles.popoverContent), otherPopoverStyles), {\n      elevation: elevation\n    });\n    if (nextGeom) {\n      contentWrapperStyle.maxWidth = nextGeom.forcedContentSize.width;\n      contentWrapperStyle.maxHeight = nextGeom.forcedContentSize.height;\n    }\n    var arrowPositionStyle = {};\n    if (geom.placement === Placement.RIGHT || geom.placement === Placement.LEFT) {\n      arrowPositionStyle.top = geom.anchorPoint.y - geom.popoverOrigin.y - arrowSize.height;\n      if (transformStyle.width) transformStyle.width += arrowSize.height;\n      if (geom.placement === Placement.RIGHT) contentWrapperStyle.left = arrowSize.height;\n    } else if (geom.placement === Placement.TOP || geom.placement === Placement.BOTTOM) {\n      arrowPositionStyle.left = geom.anchorPoint.x - geom.popoverOrigin.x - arrowSize.width / 2;\n      if (transformStyle.height) transformStyle.height += arrowSize.height;\n      if (geom.placement === Placement.BOTTOM) contentWrapperStyle.top = arrowSize.height;\n    }\n    switch (geom.placement) {\n      case Placement.TOP:\n        arrowPositionStyle.bottom = 0;\n        break;\n      case Placement.BOTTOM:\n        arrowPositionStyle.top = 0;\n        break;\n      case Placement.LEFT:\n        arrowPositionStyle.right = 0;\n        break;\n      case Placement.RIGHT:\n        arrowPositionStyle.left = 0;\n        break;\n      default:\n    }\n    var backgroundShift = animatedValues.fade.interpolate({\n      inputRange: [0, 0.0001, 1],\n      outputRange: [0, FIX_SHIFT, FIX_SHIFT]\n    });\n    var backgroundStyle = __assign(__assign(__assign({}, styles.background), {\n      transform: [{\n        translateY: backgroundShift\n      }]\n    }), StyleSheet.flatten(this.props.backgroundStyle));\n    var containerStyle = __assign(__assign({}, styles.container), {\n      opacity: animatedValues.fade\n    });\n    var backgroundColor = flattenedPopoverStyle.backgroundColor || styles.popoverContent.backgroundColor;\n    return React.createElement(View, {\n      pointerEvents: \"box-none\",\n      style: [styles.container, {\n        top: -1 * FIX_SHIFT\n      }]\n    }, React.createElement(View, {\n      pointerEvents: \"box-none\",\n      style: [styles.container, {\n        top: FIX_SHIFT,\n        flex: 1\n      }],\n      onLayout: function onLayout(evt) {\n        return _this.props.onDisplayAreaChanged(new Rect(evt.nativeEvent.layout.x, evt.nativeEvent.layout.y - FIX_SHIFT, evt.nativeEvent.layout.width, evt.nativeEvent.layout.height));\n      }\n    }), React.createElement(Animated.View, {\n      pointerEvents: \"box-none\",\n      style: containerStyle\n    }, this.props.showBackground !== false && React.createElement(TouchableWithoutFeedback, {\n      onPress: this.props.onRequestClose\n    }, React.createElement(Animated.View, {\n      style: backgroundStyle\n    })), React.createElement(View, {\n      pointerEvents: \"box-none\",\n      style: __assign({\n        top: 0,\n        left: 0\n      }, shadowStyle)\n    }, React.createElement(Animated.View, {\n      style: transformStyle\n    }, React.createElement(View, {\n      ref: this.popoverRef,\n      style: contentWrapperStyle,\n      onLayout: function onLayout(evt) {\n        var layout = __assign({}, evt.nativeEvent.layout);\n        setTimeout(function () {\n          return _this._isMounted && _this.measureContent(new Size(layout.width, layout.height));\n        }, 10);\n      }\n    }, this.props.children), geom.placement !== Placement.FLOATING && React.createElement(Arrow, {\n      ref: this.arrowRef,\n      placement: geom.placement,\n      color: backgroundColor,\n      arrowSize: arrowSize,\n      positionStyle: arrowPositionStyle,\n      elevation: elevation\n    })))));\n  };\n  return BasePopover;\n}(Component);\nexport default BasePopover;","map":{"version":3,"sources":["../src/BasePopover.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React, { Component } from 'react';\nimport { Animated, Easing, I18nManager, StyleSheet, TouchableWithoutFeedback, View } from 'react-native';\nimport Arrow from './Arrow';\nimport { DEBUG, DEFAULT_ARROW_SIZE, FIX_SHIFT, isWeb, styles } from './Constants';\nimport { computeGeometry, Geometry } from './Geometry';\nimport { Placement, Point, Rect, Size } from './Types';\nimport { getChangedProps, getRectForRef } from './Utility';\nvar BasePopover = /** @class */ (function (_super) {\n    __extends(BasePopover, _super);\n    function BasePopover() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = {\n            requestedContentSize: null,\n            activeGeom: undefined,\n            nextGeom: undefined,\n            showing: false,\n            animatedValues: {\n                scale: new Animated.Value(0),\n                translate: new Animated.ValueXY(),\n                fade: new Animated.Value(0),\n                translateArrow: new Animated.ValueXY()\n            }\n        };\n        _this._isMounted = false;\n        _this.animating = false;\n        _this.animateOutAfterShow = false;\n        _this.popoverRef = React.createRef();\n        _this.arrowRef = React.createRef();\n        return _this;\n    }\n    BasePopover.prototype.debug = function (line, obj) {\n        if (DEBUG || this.props.debug)\n            console.log(\"[\" + (new Date()).toISOString() + \"] \" + line + (obj ? \": \" + JSON.stringify(obj) : ''));\n    };\n    BasePopover.prototype.componentDidMount = function () {\n        this._isMounted = true;\n    };\n    BasePopover.prototype.componentDidUpdate = function (prevProps) {\n        // Make sure a value we care about has actually changed\n        var importantProps = ['isVisible', 'fromRect', 'displayArea', 'verticalOffset', 'offset', 'placement'];\n        var changedProps = getChangedProps(this.props, prevProps, importantProps);\n        if (!changedProps.length)\n            return;\n        this.debug('[BasePopover] componentDidUpdate - changedProps', changedProps);\n        if (this.props.isVisible !== prevProps.isVisible) {\n            this.debug(\"componentDidUpdate - isVisible changed, now \" + this.props.isVisible);\n            if (!this.props.isVisible) {\n                if (this.state.showing)\n                    this.animateOut();\n                else\n                    this.animateOutAfterShow = true;\n                this.debug('componentDidUpdate - Hiding popover');\n            }\n        }\n        else if (this.props.isVisible && prevProps.isVisible) {\n            this.debug('componentDidUpdate - isVisible not changed, handling other changes');\n            this.handleChange();\n        }\n    };\n    BasePopover.prototype.componentWillUnmount = function () {\n        this._isMounted = false;\n        if (this.state.showing) {\n            this.debug('componentWillUnmount');\n            this.animateOut();\n        }\n    };\n    BasePopover.prototype.measureContent = function (requestedContentSize) {\n        var _this = this;\n        if (!requestedContentSize.width) {\n            console.warn(\"Popover Warning - Can't Show - The Popover content has a width of 0, so there is nothing to present.\");\n            return;\n        }\n        if (!requestedContentSize.height) {\n            console.warn(\"Popover Warning - Can't Show - The Popover content has a height of 0, so there is nothing to present.\");\n            return;\n        }\n        if (this.props.skipMeasureContent()) {\n            this.debug(\"measureContent - Skipping, waiting for resize to finish\");\n            return;\n        }\n        if (!this.state.requestedContentSize ||\n            !requestedContentSize.equals(this.state.requestedContentSize)) {\n            this.debug(\"measureContent - new requestedContentSize: \" + JSON.stringify(requestedContentSize) + \" (used to be \" + JSON.stringify(this.state.requestedContentSize) + \")\");\n            this.setState({ requestedContentSize: requestedContentSize }, function () { return _this.handleChange(); });\n        }\n        else {\n            this.debug(\"measureContent - Skipping, content size did not change\");\n        }\n    };\n    /*\n     * Many factors may cause the geometry to change.\n     * This function collects all of them, waiting for 200ms after the last change,\n     * then takes action, either bringing up the popover or moving it to its new location\n     */\n    BasePopover.prototype.handleChange = function () {\n        var _this = this;\n        if (this.handleChangeTimeout)\n            clearTimeout(this.handleChangeTimeout);\n        /*\n         * This function will be called again once we have a requested content size,\n         * so safe to ignore for now\n         */\n        if (!this.state.requestedContentSize) {\n            this.debug('handleChange - no requestedContentSize, exiting...');\n            return;\n        }\n        this.debug('handleChange - waiting 100ms to accumulate all changes');\n        this.handleChangeTimeout = setTimeout(function () {\n            var _a = _this.state, activeGeom = _a.activeGeom, animatedValues = _a.animatedValues, requestedContentSize = _a.requestedContentSize;\n            var _b = _this.props, arrowSize = _b.arrowSize, popoverStyle = _b.popoverStyle, fromRect = _b.fromRect, displayArea = _b.displayArea, placement = _b.placement, onOpenStart = _b.onOpenStart, arrowShift = _b.arrowShift, onPositionChange = _b.onPositionChange, offset = _b.offset, popoverShift = _b.popoverShift;\n            if (requestedContentSize) {\n                _this.debug('handleChange - requestedContentSize', requestedContentSize);\n                _this.debug('handleChange - displayArea', displayArea);\n                _this.debug('handleChange - fromRect', fromRect);\n                if (placement)\n                    _this.debug('handleChange - placement', placement.toString());\n                var geom_1 = computeGeometry({\n                    requestedContentSize: requestedContentSize,\n                    placement: placement,\n                    fromRect: fromRect,\n                    displayArea: displayArea,\n                    arrowSize: arrowSize || DEFAULT_ARROW_SIZE,\n                    popoverStyle: popoverStyle,\n                    arrowShift: arrowShift,\n                    debug: _this.debug.bind(_this),\n                    previousPlacement: _this.getGeom().placement,\n                    offset: offset,\n                    popoverShift: popoverShift\n                });\n                _this.setState({ nextGeom: geom_1, requestedContentSize: requestedContentSize }, function () {\n                    if (geom_1.viewLargerThanDisplayArea.width || geom_1.viewLargerThanDisplayArea.height) {\n                        /*\n                         * If the view initially overflowed the display area,\n                         * wait one more render cycle to test-render it within\n                         * the display area to get final calculations for popoverOrigin before show\n                         */\n                        _this.debug('handleChange - delaying showing popover because viewLargerThanDisplayArea');\n                    }\n                    else if (!activeGeom) {\n                        _this.debug('handleChange - animating in');\n                        if (onOpenStart)\n                            setTimeout(onOpenStart);\n                        _this.animateIn();\n                    }\n                    else if (activeGeom && !Geometry.equals(activeGeom, geom_1)) {\n                        var moveTo = new Point(geom_1.popoverOrigin.x, geom_1.popoverOrigin.y);\n                        _this.debug('handleChange - Triggering popover move to', moveTo);\n                        _this.animateTo({\n                            values: animatedValues,\n                            fade: 1,\n                            scale: 1,\n                            translatePoint: moveTo,\n                            easing: Easing.inOut(Easing.quad),\n                            geom: geom_1,\n                            callback: onPositionChange\n                        });\n                    }\n                    else {\n                        _this.debug('handleChange - no change');\n                    }\n                });\n            }\n        }, 100);\n    };\n    BasePopover.getPolarity = function () {\n        return I18nManager.isRTL ? -1 : 1;\n    };\n    BasePopover.prototype.getGeom = function () {\n        var _a = this.state, activeGeom = _a.activeGeom, nextGeom = _a.nextGeom;\n        if (activeGeom)\n            return activeGeom;\n        if (nextGeom)\n            return nextGeom;\n        return new Geometry({\n            popoverOrigin: new Point(0, 0),\n            anchorPoint: new Point(0, 0),\n            placement: Placement.AUTO,\n            forcedContentSize: new Size(0, 0),\n            viewLargerThanDisplayArea: {\n                width: false,\n                height: false\n            }\n        });\n    };\n    BasePopover.prototype.getTranslateOrigin = function () {\n        var requestedContentSize = this.state.requestedContentSize;\n        var arrowSize = this.props.arrowSize || DEFAULT_ARROW_SIZE;\n        var _a = this.getGeom(), forcedContentSize = _a.forcedContentSize, viewLargerThanDisplayArea = _a.viewLargerThanDisplayArea, anchorPoint = _a.anchorPoint, placement = _a.placement;\n        var viewWidth = 0;\n        if (viewLargerThanDisplayArea.width && (forcedContentSize === null || forcedContentSize === void 0 ? void 0 : forcedContentSize.width))\n            viewWidth = forcedContentSize.width;\n        else if (requestedContentSize === null || requestedContentSize === void 0 ? void 0 : requestedContentSize.width)\n            viewWidth = requestedContentSize.width;\n        if ([Placement.LEFT, Placement.RIGHT].includes(placement))\n            viewWidth += arrowSize.height;\n        var viewHeight = 0;\n        if (viewLargerThanDisplayArea.height && (forcedContentSize === null || forcedContentSize === void 0 ? void 0 : forcedContentSize.height))\n            viewHeight = forcedContentSize.height;\n        else if (requestedContentSize === null || requestedContentSize === void 0 ? void 0 : requestedContentSize.height)\n            viewHeight = requestedContentSize.height;\n        if ([Placement.TOP, Placement.BOTTOM].includes(placement))\n            viewHeight += arrowSize.height;\n        this.debug('getTranslateOrigin - popoverSize', { width: viewWidth, height: viewHeight });\n        this.debug('getTranslateOrigin - anchorPoint', anchorPoint);\n        return new Point(anchorPoint.x - (viewWidth / 2), anchorPoint.y - (viewHeight / 2));\n    };\n    BasePopover.prototype.animateOut = function () {\n        var _this = this;\n        if (this.props.onCloseStart)\n            setTimeout(this.props.onCloseStart);\n        if (this._isMounted)\n            this.setState({ showing: false });\n        this.debug('animateOut - isMounted', this._isMounted);\n        this.animateTo({\n            values: this.state.animatedValues,\n            fade: 0,\n            scale: 0,\n            translatePoint: this.getTranslateOrigin(),\n            callback: function () { return setTimeout(_this.props.onCloseComplete); },\n            easing: Easing.inOut(Easing.quad),\n            geom: this.getGeom()\n        });\n    };\n    BasePopover.prototype.animateIn = function () {\n        var _this = this;\n        var nextGeom = this.state.nextGeom;\n        if (nextGeom !== undefined && nextGeom instanceof Geometry) {\n            var values = this.state.animatedValues;\n            // Should grow from anchor point\n            var translateStart = this.getTranslateOrigin();\n            // eslint-disable-next-line\n            translateStart.y += FIX_SHIFT; // Temp fix for useNativeDriver issue\n            values.translate.setValue(translateStart);\n            var translatePoint = new Point(nextGeom.popoverOrigin.x, nextGeom.popoverOrigin.y);\n            this.debug('animateIn - translateStart', translateStart);\n            this.debug('animateIn - translatePoint', translatePoint);\n            this.animateTo({\n                values: values,\n                fade: 1,\n                scale: 1,\n                translatePoint: translatePoint,\n                easing: Easing.out(Easing.back(1)),\n                geom: nextGeom,\n                callback: function () {\n                    if (_this._isMounted) {\n                        _this.setState({ showing: true });\n                        if (_this.props.debug || DEBUG) {\n                            setTimeout(function () {\n                                return _this.popoverRef.current &&\n                                    getRectForRef(_this.popoverRef).then(function (rect) { return _this.debug('animateIn - onOpenComplete - Calculated Popover Rect', rect); });\n                            });\n                            setTimeout(function () {\n                                return _this.arrowRef.current &&\n                                    getRectForRef(_this.arrowRef).then(function (rect) { return _this.debug('animateIn - onOpenComplete - Calculated Arrow Rect', rect); });\n                            });\n                        }\n                    }\n                    if (_this.props.onOpenComplete)\n                        setTimeout(_this.props.onOpenComplete);\n                    if (_this.animateOutAfterShow || !_this._isMounted) {\n                        _this.animateOut();\n                        _this.animateOutAfterShow = false;\n                    }\n                }\n            });\n        }\n    };\n    BasePopover.prototype.animateTo = function (args) {\n        var _this = this;\n        var fade = args.fade, translatePoint = args.translatePoint, scale = args.scale, callback = args.callback, easing = args.easing, values = args.values;\n        var commonConfig = __assign({ duration: 300, easing: easing, useNativeDriver: !isWeb }, this.props.animationConfig);\n        if (this.animating) {\n            setTimeout(function () { return _this.animateTo(args); }, 100);\n            return;\n        }\n        // eslint-disable-next-line\n        translatePoint.y = translatePoint.y + FIX_SHIFT; // Temp fix for useNativeDriver issue\n        if (!fade && fade !== 0) {\n            console.log('Popover: Fade value is null');\n            return;\n        }\n        if (!translatePoint) {\n            console.log('Popover: Translate Point value is null');\n            return;\n        }\n        if (!scale && scale !== 0) {\n            console.log('Popover: Scale value is null');\n            return;\n        }\n        this.animating = true;\n        Animated.parallel([\n            Animated.timing(values.fade, __assign(__assign({}, commonConfig), { toValue: fade })),\n            Animated.timing(values.translate, __assign(__assign({}, commonConfig), { toValue: translatePoint })),\n            Animated.timing(values.scale, __assign(__assign({}, commonConfig), { toValue: scale }))\n        ]).start(function () {\n            _this.animating = false;\n            if (_this._isMounted)\n                _this.setState({ activeGeom: _this.state.nextGeom });\n            if (callback)\n                callback();\n        });\n    };\n    BasePopover.prototype.render = function () {\n        var _this = this;\n        var _a = this.state, animatedValues = _a.animatedValues, nextGeom = _a.nextGeom, requestedContentSize = _a.requestedContentSize;\n        var flattenedPopoverStyle = StyleSheet.flatten(this.props.popoverStyle);\n        var arrowSize = this.props.arrowSize || DEFAULT_ARROW_SIZE;\n        var geom = this.getGeom();\n        var transformStyle = __assign(__assign({ position: 'absolute' }, requestedContentSize), { transform: [\n                { translateX: animatedValues.translate.x },\n                { translateY: animatedValues.translate.y },\n                { scale: animatedValues.scale }\n            ] });\n        var shadowOffset = flattenedPopoverStyle.shadowOffset, shadowColor = flattenedPopoverStyle.shadowColor, shadowOpacity = flattenedPopoverStyle.shadowOpacity, shadowRadius = flattenedPopoverStyle.shadowRadius, elevation = flattenedPopoverStyle.elevation, otherPopoverStyles = __rest(flattenedPopoverStyle, [\"shadowOffset\", \"shadowColor\", \"shadowOpacity\", \"shadowRadius\", \"elevation\"]);\n        var shadowStyle = {\n            shadowOffset: shadowOffset,\n            shadowColor: shadowColor,\n            shadowOpacity: shadowOpacity,\n            shadowRadius: shadowRadius\n        };\n        var contentWrapperStyle = __assign(__assign(__assign({}, styles.popoverContent), otherPopoverStyles), { elevation: elevation });\n        /*\n         * We want to always use next here, because the we need this to re-render\n         * before we can animate to the correct spot for the active.\n         */\n        if (nextGeom) {\n            contentWrapperStyle.maxWidth = nextGeom.forcedContentSize.width;\n            contentWrapperStyle.maxHeight = nextGeom.forcedContentSize.height;\n        }\n        var arrowPositionStyle = {};\n        if (geom.placement === Placement.RIGHT || geom.placement === Placement.LEFT) {\n            arrowPositionStyle.top = geom.anchorPoint.y - geom.popoverOrigin.y - arrowSize.height;\n            if (transformStyle.width)\n                transformStyle.width += arrowSize.height;\n            if (geom.placement === Placement.RIGHT)\n                contentWrapperStyle.left = arrowSize.height;\n        }\n        else if (geom.placement === Placement.TOP || geom.placement === Placement.BOTTOM) {\n            arrowPositionStyle.left = geom.anchorPoint.x - geom.popoverOrigin.x - (arrowSize.width / 2);\n            if (transformStyle.height)\n                transformStyle.height += arrowSize.height;\n            if (geom.placement === Placement.BOTTOM)\n                contentWrapperStyle.top = arrowSize.height;\n        }\n        switch (geom.placement) {\n            case Placement.TOP:\n                arrowPositionStyle.bottom = 0;\n                break;\n            case Placement.BOTTOM:\n                arrowPositionStyle.top = 0;\n                break;\n            case Placement.LEFT:\n                arrowPositionStyle.right = 0;\n                break;\n            case Placement.RIGHT:\n                arrowPositionStyle.left = 0;\n                break;\n            default:\n        }\n        // Temp fix for useNativeDriver issue\n        var backgroundShift = animatedValues.fade.interpolate({\n            inputRange: [0, 0.0001, 1],\n            outputRange: [0, FIX_SHIFT, FIX_SHIFT]\n        });\n        var backgroundStyle = __assign(__assign(__assign({}, styles.background), { transform: [{ translateY: backgroundShift }] }), StyleSheet.flatten(this.props.backgroundStyle));\n        var containerStyle = __assign(__assign({}, styles.container), { opacity: animatedValues.fade });\n        var backgroundColor = flattenedPopoverStyle.backgroundColor ||\n            styles.popoverContent.backgroundColor;\n        return (React.createElement(View, { pointerEvents: \"box-none\", style: [styles.container, { top: -1 * FIX_SHIFT }] },\n            React.createElement(View, { pointerEvents: \"box-none\", style: [styles.container, { top: FIX_SHIFT, flex: 1 }], onLayout: function (evt) { return _this.props.onDisplayAreaChanged(new Rect(evt.nativeEvent.layout.x, evt.nativeEvent.layout.y - FIX_SHIFT, evt.nativeEvent.layout.width, evt.nativeEvent.layout.height)); } }),\n            React.createElement(Animated.View, { pointerEvents: \"box-none\", style: containerStyle },\n                this.props.showBackground !== false && (React.createElement(TouchableWithoutFeedback, { onPress: this.props.onRequestClose },\n                    React.createElement(Animated.View, { style: backgroundStyle }))),\n                React.createElement(View, { pointerEvents: \"box-none\", style: __assign({ top: 0, left: 0 }, shadowStyle) },\n                    React.createElement(Animated.View, { style: transformStyle },\n                        React.createElement(View, { ref: this.popoverRef, style: contentWrapperStyle, onLayout: function (evt) {\n                                var layout = __assign({}, evt.nativeEvent.layout);\n                                setTimeout(function () { return _this._isMounted &&\n                                    _this.measureContent(new Size(layout.width, layout.height)); }, 10);\n                            } }, this.props.children),\n                        geom.placement !== Placement.FLOATING &&\n                            React.createElement(Arrow, { ref: this.arrowRef, placement: geom.placement, color: backgroundColor, arrowSize: arrowSize, positionStyle: arrowPositionStyle, elevation: elevation }))))));\n    };\n    return BasePopover;\n}(Component));\nexport default BasePopover;\n//# sourceMappingURL=BasePopover.js.map"]},"metadata":{},"sourceType":"module"}